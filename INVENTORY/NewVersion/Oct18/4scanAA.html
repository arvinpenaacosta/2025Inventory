<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Asset Inventory Manager</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <script src="static/assets/js/html5-qrcode.min.js"></script>
 
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background-color: #121212;
      color: #ffffff;
      font-family: 'Inter', sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 20px;
      padding-top: 50px; 
    }

    .frosted-glass {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);
      width: 100%;
      max-width: 450px;
      padding: 30px;
      text-align: center;
    }

    .app-header {
      margin-bottom: 25px;
      color: #0d6efd;
    }
    
    .app-header h3 {
        font-weight: 700;
        letter-spacing: 1px;
    }

    input {
      background-color: #333;
      color: #fff;
      border: 1px solid #555;
      border-radius: 8px;
      padding: 10px; 
      font-size: 0.85em; 
      text-align: left;
      font-weight: 500;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
    }
    
    .vertical-input-group {
        width: 100%;
        margin-bottom: 1rem;
    }

    .btn-primary {
      background-color: #0d6efd;
      border: none;
      border-radius: 8px;
      padding: 12px 20px;
      font-weight: bold;
      transition: background-color 0.2s;
    }

    .btn-primary:hover:not(:disabled) {
      background-color: #35fd0d;
    }

    .btn-primary:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    /* NEW STYLE: Button for saving the entry */
    .btn-success {
        background-color: #28a745;
        border: none;
        border-radius: 8px;
        padding: 12px 20px;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    .btn-success:hover:not(:disabled) {
        background-color: #1e7e34;
    }
    .btn-success:disabled {
        opacity: 0.6;
        cursor: not-allowed;
    }
    
    /* Hide the button when scanning is active */
    .scanning-active #searchBtn {
        display: none;
    }
    /* Show the results when scanning is complete */
    .scanning-complete #resultsOutput {
        display: block;
    }
    /* Hide the save button initially */
    #saveEntryBtn {
        display: none;
    }
    
    /* Modal Styling */
    .modal-content {
      background-color: #222;
      border: none;
      border-radius: 12px;
    }
    
    .modal-header {
        border-bottom: 1px solid #333;
    }

    #qr-reader {
      margin-top: 10px;
      border-radius: 10px;
      overflow: hidden;
      min-height: 250px; 
    }
    
    /* Ensure the modal body has margin when the instruction text is removed */
    .modal-body {
        padding-bottom: 20px;
    }
    
    /* New styles for pause feedback */
    .pause-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.7);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: white;
        font-size: 1.5em;
        font-weight: bold;
        z-index: 10;
        border-radius: 10px;
    }
    
    /* Custom style for the DUPLICATE message box */
    .duplicate-message-box {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: rgba(180, 0, 0, 0.9);
        color: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 20;
        font-size: 1.1em;
        font-weight: bold;
        box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
        min-width: 90%;
    }
  </style>
</head>

<body>


  <div class="frosted-glass" id="appContainer">
    <div class="app-header">
        <h3>Asset Inventory Manager</h3>
    </div>
    
    <div id="resultsOutput" class="mb-4" style="display: none;">
        <h6 class="text-start text-info mb-3">Captured Temp Values:</h6>
        
        <div class="vertical-input-group">
            <input type="text" id="location" name="location" class="form-control" placeholder="Scan 1: Location/Station" />
        </div>
        
        <div class="vertical-input-group">
            <input type="text" id="val1" name="val1" class="form-control"  placeholder="Scan 2: Device 1 ID" />
        </div>
        
        <div class="vertical-input-group">
            <input type="text" id="val2" name="val2" class="form-control"  placeholder="Scan 3: Device 2 Type/Model" />
        </div>
        
        <div class="vertical-input-group mb-0"> <input type="text" id="val3" name="val3" class="form-control" placeholder="Scan 4: Optional Status Note" />
        </div>

        
    </div>

    <button class="btn btn-primary w-100 mb-3" id="searchBtn">
      <i class="fas fa-qrcode"></i> START SCANNING
    </button>
    
    <button class="btn btn-success w-100" id="saveEntryBtn" disabled>
      <i class="fas fa-save"></i> SAVE INVENTORY ENTRY
    </button>
    
  </div>
  
  <div
    class="modal fade"
    id="scannerModal"
    tabindex="-1"
    aria-hidden="true"
    data-bs-backdrop="static"
  >
    <div class="modal-dialog modal-lg">
      <div class="modal-content text-center">
        <div class="modal-header">
          <h5 class="modal-title" id="scanModalTitle">Ready...</h5>
          <button
            type="button"
            class="btn-close btn-close-white"
            data-bs-dismiss="modal"
            aria-label="Close"
            id="closeScannerBtn"
          ></button>
        </div>
        <div class="modal-body" style="position: relative;">
          <div id="pauseOverlay" class="pause-overlay" style="display: none;">
                <i class="fas fa-pause fa-2x mb-3"></i>
                PAUSED
                </div>
          
          <div id="duplicateMessageBox" class="duplicate-message-box" style="display: none;">
              ðŸš« DUPLICATE SCAN ðŸš«
              <p class="mt-2 mb-0" id="duplicateSerialText"></p>
          </div>
          
          <div id="qr-reader" style="width: 100%"></div>
          
          <button class="btn btn-danger w-100 mt-3" id="stopScanBtn" style="display: none;">
              Stop
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <audio id="beep-sound" src="static/assets/audio/beep.mp3" preload="auto"></audio>
  <audio id="cancel-sound" src="static/assets/audio/cancel2.mp3" preload="auto"></audio>
  
  <script src="static/assets/js/qrsteps.js"></script> 
  
  <script>
    // Initialize the Save button event listener
    document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('saveEntryBtn').addEventListener('click', saveInventoryEntry);
    });

    /**
     * Placeholder function to handle the final inventory data save.
     * In a real application, this would contain API calls or IndexedDB logic.
     */
    function saveInventoryEntry() {
        // 1. Collect Data from Inputs
        const inventoryData = {
            location: document.getElementById('location').value.trim(),
            device1: document.getElementById('val1').value.trim(),
            device2: document.getElementById('val2').value.trim(),
            device3: document.getElementById('val3').value.trim(),
            timestamp: new Date().toISOString()
        };

        // 2. Simple Validation Check
        if (!inventoryData.location || !inventoryData.device1 || !inventoryData.device2) {
            alert("Error: Location, Device 1, and Device 2 are required before saving.");
            return;
        }

        // 3. Process/Store Data (This is where the IndexedDB/API logic goes)
        console.log("Attempting to Save Inventory Entry:", inventoryData);

        // --- START IndexedDB/API Logic PLACEHOLDER ---
        
        // Example: You would call a function like this from the other provided file (entry42.html logic):
        // if (typeof saveRecordDirectly === 'function') {
        //     saveRecordDirectly(inventoryData); 
        // } else {
            // Simplified success simulation for now
            alert(`Inventory saved successfully!\nLocation: ${inventoryData.location}`);
        // }

        // --- END IndexedDB/API Logic PLACEHOLDER ---
        
        // 4. Reset UI after save
        document.getElementById('location').value = '';
        document.getElementById('val1').value = '';
        document.getElementById('val2').value = '';
        document.getElementById('val3').value = '';
        
        document.getElementById('resultsOutput').style.display = 'none';
        document.getElementById('saveEntryBtn').style.display = 'none';
        document.getElementById('saveEntryBtn').disabled = true;
        document.getElementById('searchBtn').style.display = 'block';

        // Reset scan state (Assuming this variable is globally managed by qrsteps.js)
        if (typeof resetScanState === 'function') {
            resetScanState();
        } else {
            // Fallback: If resetScanState isn't defined, manually reset
            window.currentScanStep = 1;
        }
    }
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
